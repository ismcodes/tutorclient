<!DOCTYPE html>
<html>
<head>
<script src="https://apis.google.com/js/platform.js" async defer></script>
<meta name="google-signin-client_id" content="492971078631-2ue0vc5aik73kdmq5fitt67ro7de5q55.apps.googleusercontent.com">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.2/material.indigo-pink.min.css">
<script src="https://storage.googleapis.com/code.getmdl.io/1.0.2/material.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<script>
var email;
function onSignIn(googleUser) {
  var profile = googleUser.getBasicProfile();
  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
  console.log('Name: ' + profile.getName());
  console.log('Image URL: ' + profile.getImageUrl());
  console.log('Email: ' + profile.getEmail());
  email = profile.getEmail();
  var name = encodeURI(profile.getName());
  var image = encodeURI(profile.getImageUrl());
  if (typeof image === 'undefined'){
    image = "";
  }
  $.post("https://nileswest.herokuapp.com/login?secret_key=DEVISING&email="+email+"&name="+profile.getName()+"&image="+image, {dataType:'jsonp'});
  $.get("https://nileswest.herokuapp.com/tutees?secret_key=DEVISING").fail(function(r){addTuteesToScreen(r.responseText)});
  //lol... clean this up later
  //should not be running fail
}
function claim(tuteeElement){
var ns = tuteeElement.innerHTML.split("::");
var name = ns[0];
var subject = ns[1];
$.post("https://nileswest.herokuapp.com/resolve?secret_key=DEVISING&email="+email+"&name="+name+"&subject="+subject);
$("#switch").click();
}
function addTuteesToScreen(str){
str = str.split("|");
$(".tutee-list").empty();
for(var i = 0; i < str.length - 1; i += 2){
var name = str[i];
var subject = str[i+1];
$(".tutee-list").append("<div onclick='claim(this)'>"+name+"::"+subject+"</div>");
}
}
function switchClicked(switchButton){
if (switchButton.checked) {
$(".tutee-list").empty();
$.post("https://nileswest.herokuapp.com/change_status?secret_key=DEVISING&email="+email+"&status=1");
}
else {
 $.get("https://nileswest.herokuapp.com/tutees?secret_key=DEVISING").fail(function(r){addTuteesToScreen(r.responseText)});
$.post("https://nileswest.herokuapp.com/change_status?secret_key=DEVISING&email="+email+"&status=2");
}
}
</script>
</head>
<body>
<div class="g-signin2" data-onsuccess="onSignIn"></div>
<div class="tutee-list"></div>
<label id="switch" class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-2">
  <input type="checkbox" id="switch-2" class="mdl-switch__input" onclick="switchClicked(this)"/>
  <span class="mdl-switch__label"></span>
</label>
</body>
</html>